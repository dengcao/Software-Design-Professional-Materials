<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@include file="/common/public.jsp" %>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>采购计划列表</title>
	<script type="text/javascript" src="${ctx}/js/page.js"></script>
	<script type="text/javascript" src="${ctx}/js/search.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			getPartList();
			exportTable();
			//搜索
			$("#find").click(function(){
				var condition=$("#condition").val();
				var url2="${ctx}/buyPlan/getFList?condition="+condition;
				if(condition==""){
					getPartList();
				}else{
					search.cseatch(url2);
				}
			});

		});
	</script>

	<script type="text/javascript">
		function getPartList(){
			var url="${ctx}/buyPlan/getLimitList";
			var count=$("#count").val();
			page.pagePart(url,count);
		}
		function   customPage(obj){
			$("#table tr:gt(1)").remove();
			var status;
			var option;
			for(var i=0;i<obj.length;i++){
				switch (obj[i].propStatus){
					case 1:
						status="通过";
						option="查看详细信息";
						break;
					case 2:
						status="不通过";
						option="修改详细计划";
						break;
					case 3:
						status="审核中";
						option="查看详细信息";
						break;
					case 4:
						status="未完成";
						option="添加采购食品";
						break
				}
				var newRow = "<tr>" +
						"<td>"+obj[i].buyPlanId+"</td><td>"+obj[i].salePlanId+"</td>" +
						"<td>"+obj[i].createTime+"</td><td>"+obj[i].proposer+"</td>" +
						"<td>"+obj[i].approver+"</td><td>"+obj[i].planSumMoney+"</td>" +
						"<td>"+status+"</td><td>"+obj[i].approverOpinion+"</td>" +
						"<td>"+obj[i].remarks+"</td>" + "<td>";
				if(window.userPower==0||window.userPower==11){
					newRow=newRow+"<a id='editPlan"+i+"' href='${ctx}/buyPlan/edit?id="+obj[i].buyPlanId+"'>修改&nbsp;&nbsp;</a>"+
					"<a id='deletePlan"+i+"' href='${ctx}/buyPlan/delete?id="+obj[i].buyPlanId+"'>删除&nbsp;&nbsp;</a>";
				}else{
					$("#add").hide();
				}
				newRow=newRow+	"<a id='lookPlan"+i+"' href='${ctx}/buyPlanDetail/list?id="+obj[i].buyPlanId+"&status="+status+"'>"+option+"</a>"+"</td></tr>";
				$("#table tr:last").after(newRow);



			}

		}
	</script>


</head>

<body>
<input type="hidden" id="count" value="${count}">
<div class="pagin">
	<br/>
	<a id="add" href="${ctx }/buyPlan/add">新添采购计划</a>
	<br/>   <br/>
	<input type="text" id="condition" placeholder="请输入ID、名称、申请时间等"
			style="width:200px;"><button id="find">搜索</button>
	<button id="export">导出</button>
	<br/><br/>
	<table id="table" class="t1" style="width: 80%">
		<tr ><th colspan="10">采购计划列表</th></tr>
		<tr>
			<td>采购计划ID</td>
			<td>销售计划ID</td>
			<td>创建时间</td>
			<td>申请人</td>
			<td>审批人</td>
			<td>计划总金额</td>
			<td>审批状态</td>
			<td>审批意见</td>
			<td>备注</td>
			<td>操作</td>
		</tr>
	</table>
	<br/>
	<div id="Pagination" class="pagination"
		 style=" width: -moz-fit-content;width:-webkit-fit-content;width: fit-content;margin-left: auto;margin-right: auto;" ></div>
</div>

</body>
</html>